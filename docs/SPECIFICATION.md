# Safebox Reference Implementation Specification
## Introduction
Currently, safebox is being prototyped and implemented using Python. As features and functions stabilize, they will be documented here for other reference implementations.

### NIPS
Safebox takes its primary inspiration from [NIP-60 Cashu Wallet](https://github.com/nostr-protocol/nips/blob/master/60.md). 
 * `kind 17375` will be used to store and manage wallet configuration - just implemented
 * `kind:37375` `wallet` is used to manage wallet configuration and state - will be deprecated and the replaceable event above will be used instead.
 * `kind:37375` with `d` tag of sha256 digest of `nsec||record_name`  for storing of records having `record_name`. This is an addressable event and the wallet needs to now how to recreate the digest for the d tag to retrieve the right record'

 * `kind:7375` is used to store proofs that are used to generate Cashu tokens
 * `kind:7376` is not used. Used by NIP-60
 * `kind:7377` is used for storing transaction history.
 * `kind:7378` is used to store backup proofs

 ### Direct and GiftWrap Messages

 The range of kinds used for DMs and Gift-wrapped DMs. 
 `1059 - 1063, 21059-21063, 21400-21499`

 These are specified so that the `get_user_records` function can create the filter, select and unwrap messages, accordingly. This function might need to be separate into its own `get_user_messages`. Until now, the handling is based on the message kinds


 ## Safebox records

 ### Handling of record formats

 Once the `event.content` is decrypted, there are several possiblities of what might be store

 * `str` format, used for 
 
 ### Storing safebox records

 * `kind:32225` private health data of wallet holder
 * `kind:32227` private health data generated by consultation, intended to be transmitted
 * `kind:37375` private personal data (except for `wallet` tag which will be deprecated)

### Verifiable Credentials

Verifiable credentials are private credentials that are contained in `sleeve` addressable events
* `kind:34001` is an offer sleeve containing unsigned credentials ready for offer. Once an offer is accepted, the credentials are signed and transmitted.
* `kind:34002` is a presentation sleeve containing a signed credential that can be retrieved and presented.



### Other

All other NIPS are implemented to be compliant

* NIP-01 for core interoperability with NOSTR
* NIP-17 for secure messaging
* NIP-57 for zaps

 ### Cashu
 Safebox uses Cashu for its management of funds. 

 ### Lightning
 Safebox uses Lightning for Layer 2 bitcoin interoperability.

 ### Bitcion 
Safebox depends on for Layer 1 bitcoin interoperability.