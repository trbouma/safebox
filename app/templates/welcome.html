{% extends "uxbase.html" %}

{% block title %}Safebox{% endblock %}
{% block head %}
{{ super() }}

<script>
function consoleLog(data) {
    var logElement = document.getElementById('log');
    logElement.innerHTML += data + '\n';
  };

async function loginwithNFC() {
    consoleLog("waiting for nfc...")
    var nfc_token;
    if ("NDEFReader" in window) {
      const ndef = new NDEFReader();
      try {
        await ndef.scan();
        ndef.onreading = event => {
          const decoder = new TextDecoder();
          for (const record of event.message.records) {

            nfc_token = decoder.decode(record.data);
          }
          consoleLog(`Acquired ${nfc_token}` );
          submitToken(nfc_token);
          
        }
      } catch(error) {
        consoleLog(error);
      }
    } else {
      consoleLog("Web NFC is not supported.");
    }


  }

async function submitToken(nfc_token) {

consoleLog(`submitToken  ${nfc_token}`);
const submit_data = {"nembed": nfc_token};



await fetch('/safebox/loginwithnfc', {
method: "POST",
headers: {"Content-Type": "application/json"},        
body: JSON.stringify(submit_data)         
})   
.then((data) => {consoleLog(`done ${data}`)});

window.location.href="/safebox/access" ;



}

</script>


{% endblock %}

{% block page_content %}



<div class="center-text">
    
        <h1>{{ branding }}</h1>
        
        <i><p class="lead">{{branding_message}}</p></i>
        <img src="img/safebox-small.png">
        <br><br>
               
            <form action="/safebox/login" method="POST">
                <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                <label for="access_key">Access Key:</label><br>
                <input type="text" id="access_key" name="access_key" type="password" placeholder="Enter access key" style="width: auto;">
                <br><br>    
                <button type="submit">Login</button>
            </form>
        </p>
        <hr>
            <form action="/onboard/website" method="POST">
                <label for="invite_code">Invite Code:</label><br>
                <input type="text" id="invite_code" name="invite_code" style="width: auto;" placeholder="Enter invite code" >
                <br><br>    
                <label>
                    <input type="checkbox" id="non_custodial" name="non_custodial" value="true">
                    I want a non-custodial private key (Danger!!!)
                </label>
                <br><br>
                <button >Get SafeBox</button>
                

            </form>
            <p>
            <a href="/recover">Recover</a>
                
            </p>
        <hr>
        <br>
        <button onclick="loginwithNFC()">Login with NFC</button>
        <br>
        <pre id="log"></pre>
            <hr>
            <p>Using quantum-qafe algorithms from: <br> <a href="https://openquantumsafe.org/">Open Quantum Safe Foundation</a><b></p>
            <p>Follow the latest blog entries <a href="https://tim-bouma.npub.pro/tag/safebox/">here</a>
            <p><a href="https://github.com/trbouma">Verify the Code</a></p> 
            <p><i>This is <a href="https://tim-bouma.npub.pro/tag/nostr/">#nostr</a> <a href="https://tim-bouma.npub.pro/tag/safebox/">#safebox</a></i></p>
             


        
    </div>
     

<script>
    setDarkMode();
</script>

{% endblock %}

{% block scripts %}
{{ super() }}


{% endblock %}
